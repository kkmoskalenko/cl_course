# Практическое задание №5

**Задача:** Разработать поисковую систему на основе тезауруса специализированной области знаний.  
**Исходный код:** https://github.com/kkmoskalenko/cl_course/tree/main/Task_5

## Описание решения

Тезаурус был составлен на основе РуТез, из которого были извлечены понятия, относящиеся к теме кино и сериалов. Тезаурус хранится в виде header-файла, где каждому понятию соответствует набор синонимов, гиперонимов и гипонимов:

```c++
struct Descriptor {
    const std::vector<std::string> synset;
    const std::vector<std::string> hyperonym;
    const std::vector<std::string> hyponym;
};

const Descriptor thesaurus[] = {
        {{"КИНО", "ФИЛЬМ", "ЛЕНТА"},
         {"КИНОВИДЕОМАТЕРИАЛ", "КИНОВИДЕОПРОДУКЦИЯ", "КИНОВИДЕОПРОИЗВЕДЕНИЕ", "КИНОВИДЕОРОЛИК", "КИНОВИДЕОФИЛЬМ",
          "КИНОМАТЕРИАЛ"},
         {"КОРОТКОМЕТРАЖНЫЙ ФИЛЬМ", "КОРОТКОМЕТРАЖКА", "ВИДЕОПРОИЗВЕДЕНИЕ", "ВИДЕОФИЛЬМ", "КАРТИНА", "КИНОКАРТИНА",
          "КИНОФИЛЬМ", "КИНЕМАТОГРАФИЧЕСКАЯ ПРОДУКЦИЯ", "КИНОЛЕНТА", "КИНОАЛЬМАНАХ", "КИНОПРОИЗВЕДЕНИЕ",
          "КИНОПРОДУКЦИЯ", "КИНОСЕРИАЛ", "КИНЕМАТОГРАФИЧЕСКОЕ ПРОИЗВЕДЕНИЕ", "ПРОДУКЦИЯ КИНОСТУДИЙ", "КИНОЭПОПЕЯ",
          "КИНОРАБОТА", "КИНОШКА", "АНИМАЦИОННЫЙ ФИЛЬМ", "МУЛЬТИПЛИКАЦИОННЫЙ ФИЛЬМ", "МУЛЬТФИЛЬМ", "МУЛЬТИК",
          "МУЛЬТЯШКА", "МУЛЬТИПЛИКАЦИОННОЕ КИНО", "МУЛЬТСЕРИАЛ", "АНИМАЦИОННОЕ КИНО", "НЕИГРОВОЙ ФИЛЬМ",
          "НЕИГРОВОЕ КИНО", "ХУДОЖЕСТВЕННАЯ КАРТИНА", "ХУДОЖЕСТВЕННЫЙ ФИЛЬМ", "ХУДОЖЕСТВЕННОЕ КИНО",
          "ХУДОЖЕСТВЕННЫЙ КИНОФИЛЬМ", "ИГРОВОЙ ФИЛЬМ", "ИГРОВОЕ КИНО", "КИНОПОВЕСТВОВАНИЕ", "КИНОИСТОРИЯ",
          "ТЕЛЕВИЗИОННЫЙ ФИЛЬМ", "ТЕЛЕФИЛЬМ", "МУЗЫКАЛЬНЫЙ ФИЛЬМ", "ПОЛНОМЕТРАЖНЫЙ ФИЛЬМ", "ДОКУМЕНТАЛЬНОЕ КИНО",
          "ДОКУМЕНТАЛЬНЫЙ ФИЛЬМ", "ДОКУМЕНТАЛЬНАЯ КАРТИНА", "ДОКУМЕНТАЛЬНАЯ ЛЕНТА", "СЕРИЯ", "СЕРИЯ ФИЛЬМА",
          "ТЕЛЕСЕРИЯ"}},
        {{"СЕРИАЛ"}, {"РАДИОТЕЛЕПЕРЕДАЧА", "ТЕЛЕРАДИОПЕРЕДАЧА", "ПЕРЕДАЧА"},
         {"ТЕЛЕСЕРИАЛ", "ТЕЛЕВИЗИОННЫЙ СЕРИАЛ", "МНОГОСЕРИЙНЫЙ ФИЛЬМ", "МНОГОСЕРИЙКА", "МЫЛЬНАЯ ОПЕРА"}},
        {{"АКТЕР", "АКТРИСА", "ИСПОЛНИТЕЛЬ РОЛЕЙ", "ЛИЦЕДЕЙ", "ЛИЦЕДЕЙКА", "ИСПОЛНИТЕЛЬНИЦА РОЛИ",
          "СЛУЖИТЕЛЬ МЕЛЬПОМЕНЫ"}, {"АРТИСТ", "АРТИСТКА"},
         {"СТУДИЕЦ", "АКТЕР СТУДИИ", "ПРИМА", "ПРИМА ТЕАТРА", "ВЕДУЩАЯ АКТРИСА", "КИНОАКТЕР", "КИНОАКТРИСА",
          "АРТИСТКА КИНО", "АКТЕР КИНО", "КИНОАРТИСТ", "КИНОАРТИСТКА", "АРТИСТ КИНО", "АКТРИСА КИНО", "СТАТИСТ",
          "СТАТИСТКА", "АКТЕР МАССОВОЙ СЦЕНЫ"}},
        {{"ПРЕМЬЕРА", "ПРЕМЬЕРНЫЙ ПОКАЗ", "ПРЕМЬЕРНОЕ ПРЕДСТАВЛЕНИЕ", "ПРЕМЬЕРНЫЙ СПЕКТАКЛЬ", "ПЕРВОЕ ПРЕДСТАВЛЕНИЕ"},
         {"ПОСТАНОВКА", "ПРЕДСТАВЛЕНИЕ", "ДЕЙСТВО"}, {}},
         ...
};
```

Изначально производится индексация текстов, затем для поиского запроса и каждого документа подсчитывается score с помощью функции ранжирования `BM25`. Связанные понятия из тезауруса также учитываются, но с понижающим коэффициентом.
Также реализованы дополнительные текстовые факторы ранжирования (score увеличивается, если слова из запроса встречаются в документе подряд или с небольшими интервалами).

В качестве поисковых запросов используются реальные запросы пользователей, полученные с сервиса Google Trends:

```json
[
  "фильмы 2019",
  "новинки кино 2018",
  "последний богатырь",
  "движение вверх",
  "мстители война бесконечности",
  "веном смотреть онлайн",
  "игра в кальмара смотреть",
  "очень странные дела",
  "топ сериалов netflix",
  "kinopoisk hd",
  "актер том круз",
  "дата выхода человек паук нет пути домой",
  "каннский фестиваль 2018",
  "т 34 фильм 2018 дата выхода",
  "звезды голливуда",
  "игра престолов 8 сезон 1 серия",
  "мстители финал премьера",
  "однажды в голливуде",
  "режиссер фильма движение вверх",
  "режиссёр триллера сияние"
]
```



## Оценка результатов

Метрики вычислялись для 5 поисковых запросов на случайной подвыборке из 100 текстов.

| Запрос                        | Точность       | Полнота        | F-мера   |
| ----------------------------- | -------------- | -------------- | -------- |
| «дата выхода фильма»          | 13 / 15 = 0.87 | 13 / 14 = 0.93 | 0.9      |
| «международный кинофестиваль» | 3 / 4 = 0.75   | 3 / 3 = 1.0    | 0.86     |
| «игра престолов»              | 3 / 5 = 0.6    | 3 / 3 = 1.0    | 0.75     |
| «первый трейлер сериала»      | 5 / 8 = 0.625  | 5 / 7 = 0.71   | 0.66     |
| «актер джонни депп»           | 2 / 6 = 0.33   | 2 / 2 = 1.0    | 0.5      |
|                               | **0.68**       | **0.89**       | **0.77** |

Невысокая точность для отдельных запросов обсуловлена небольшим размером подвыборки — в ней может не найтись достаточного числа релевантных текстов, поэтому в выдачу попадают тексты, содержащие лишь часть слов из запроса. Другая проблема, влияющая на полноту, — тезаурус может не содержать некоторые понятия (например, “мини-сериал” или “аниме-фестиваль”), из-за чего некоторые релевантные тексты не попадали в выдачу.
